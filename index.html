<!DOCTYPE html>
<html lang="en">
<head>
    <div style="text-align: center; margin: 30px 0;">
    <a href="https://github.com/getsahayindia-star/Sahay/releases/download/v1.0/Sahay.apk" class="btn-primary" style="background: #ff9800; text-decoration: none; display: inline-block; padding: 15px 30px; border-radius: 50px; font-weight: bold; color: white; box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);">
        <i class="fa-brands fa-android"></i> Download App (APK)
    </a>
    <p style="font-size: 12px; color: #666; margin-top: 10px;">
        Note: If you see a warning, click 'Settings' > 'Allow'. This is a secure student project.
    </p>
    </div>
    
<meta name="google-site-verification" content="qb7Pb8WetHocQx3oCEEOL923UZ5czMOQxue4Y_AfVtk" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sahay - The Helper</title>
    <link rel="manifest" href="manifest.json">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts (Noto Sans for broad language support) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&family=Noto+Sans+Devanagari:wght@400;600;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* Base Setup */
        body {
            font-family: 'Poppins', 'Noto Sans Bengali', 'Noto Sans Devanagari', sans-serif;
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
            overflow-x: hidden;
        }

        /* Glassmorphism Card Style */
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            border-radius: 24px;
        }

        /* Soft Animated Buttons */
        .btn-soft {
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            border: 1px solid white;
            box-shadow: 5px 5px 10px #d1d1d1, -5px -5px 10px #ffffff;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-soft:active {
            transform: scale(0.95);
            box-shadow: inset 5px 5px 10px #d1d1d1, inset -5px -5px 10px #ffffff;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
            border: none;
        }

        .btn-primary:active {
            transform: scale(0.96);
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Logo Area Placeholder */
        .logo-placeholder {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: #764ba2;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        /* Hide Scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #764ba2;
            width: 24px;
            height: 24px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased select-none">

    <!-- App Container -->
    <div id="app" class="flex-grow flex flex-col items-center justify-start pt-8 pb-24 px-4 w-full max-w-md mx-auto relative">
        
        <!-- Header / Logo -->
        <div class="mb-6 flex flex-col items-center animate-bounce-slow">
            <div class="logo-placeholder mb-3">
                <i class="fa-solid fa-hands-holding-circle"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 tracking-wide">SAHAY</h1>
            <p class="text-sm text-gray-600 font-medium tracking-widest">THE HELPER</p>
        </div>

        <!-- Notification Toast -->
        <div id="toast" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl z-50 hidden transition-all duration-300">
            <span id="toast-msg">Notification</span>
        </div>

        <!-- VIEW: Language Selection -->
        <div id="view-language" class="w-full glass-panel p-6 fade-in flex flex-col gap-4">
            <h2 class="text-center text-xl font-bold mb-4 text-gray-700">Select Language / ভাষা / भाषा</h2>
            
            <button onclick="setLanguage('bn')" class="btn-soft w-full py-4 rounded-xl flex items-center justify-between px-6">
                <span class="text-lg font-bold text-gray-700">বাংলা</span>
                <i class="fa-solid fa-chevron-right text-gray-400"></i>
            </button>

            <button onclick="setLanguage('hi')" class="btn-soft w-full py-4 rounded-xl flex items-center justify-between px-6">
                <span class="text-lg font-bold text-gray-700">हिंदी</span>
                <i class="fa-solid fa-chevron-right text-gray-400"></i>
            </button>

            <button onclick="setLanguage('en')" class="btn-soft w-full py-4 rounded-xl flex items-center justify-between px-6">
                <span class="text-lg font-bold text-gray-700">English</span>
                <i class="fa-solid fa-chevron-right text-gray-400"></i>
            </button>
        </div>

        <!-- VIEW: Authentication -->
        <div id="view-auth" class="w-full glass-panel p-6 fade-in hidden">
            <h2 id="txt-login-title" class="text-center text-2xl font-bold mb-6 text-gray-800">Welcome</h2>
            
            <div class="flex flex-col gap-4">
                <div class="relative">
                    <i class="fa-solid fa-phone absolute left-4 top-4 text-gray-400"></i>
                    <input type="tel" id="auth-phone" placeholder="Mobile Number" class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-400 bg-white/50">
                </div>
                
                <div class="relative">
                    <i class="fa-solid fa-lock absolute left-4 top-4 text-gray-400"></i>
                    <input type="password" id="auth-pass" placeholder="Password" class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-400 bg-white/50">
                </div>

                <!-- Name field only for Registration -->
                <div id="reg-name-field" class="relative hidden">
                    <i class="fa-solid fa-user absolute left-4 top-4 text-gray-400"></i>
                    <input type="text" id="auth-name" placeholder="Your Name" class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-400 bg-white/50">
                </div>

                <button id="btn-submit-auth" onclick="handleAuth()" class="btn-primary w-full py-3 rounded-xl font-bold text-lg shadow-lg mt-2 flex justify-center items-center gap-2">
                    <span id="txt-login-btn">Login</span>
                    <div id="auth-loader" class="loader hidden border-white border-t-transparent"></div>
                </button>

                <p class="text-center text-sm text-gray-600 mt-2 cursor-pointer hover:underline" onclick="toggleAuthMode()" id="txt-toggle-auth">
                    New user? Register here
                </p>
            </div>
        </div>

        <!-- VIEW: Home (Role Selection) -->
        <div id="view-home" class="w-full flex flex-col gap-6 fade-in hidden">
            
       <div class="glass-panel p-4 flex justify-between items-center mb-4">
    <div>
        <p class="text-xs text-gray-500" id="txt-welcome">Welcome,</p>
        <h3 id="user-display-name" class="font-bold text-lg text-gray-800">User</h3>
    </div>
    <a href="profile.html" class="bg-white/80 p-3 rounded-full text-purple-600 shadow-sm hover:scale-110 transition-transform border border-purple-100">
        <i class="fa-solid fa-user-circle text-2xl"></i>
    </a>
</div>


            <!-- WORKER BUTTON -->
            <button onclick="goToWorkerForm()" class="glass-panel p-8 flex flex-col items-center justify-center gap-4 transition-transform active:scale-95 group">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-3xl group-hover:scale-110 transition-transform shadow-sm">
                    <i class="fa-solid fa-briefcase"></i>
                </div>
                <h2 id="txt-need-work" class="text-2xl font-bold text-gray-700">I Need Work</h2>
                <p id="txt-need-work-desc" class="text-sm text-center text-gray-500">Register as a worker to get calls</p>
            </button>

            <!-- CUSTOMER BUTTON -->
            <button onclick="goToCustomerSearch()" class="glass-panel p-8 flex flex-col items-center justify-center gap-4 transition-transform active:scale-95 group">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-3xl group-hover:scale-110 transition-transform shadow-sm">
                    <i class="fa-solid fa-hand-holding-heart"></i>
                </div>
                <h2 id="txt-need-help" class="text-2xl font-bold text-gray-700">I Need Help</h2>
                <p id="txt-need-help-desc" class="text-sm text-center text-gray-500">Find skilled people nearby</p>
            </button>
        </div>

        <!-- VIEW: Worker Form -->
        <div id="view-worker-form" class="w-full glass-panel p-6 fade-in hidden relative">
            <button onclick="showView('view-home')" class="absolute top-4 left-4 text-gray-400 hover:text-gray-800">
                <i class="fa-solid fa-arrow-left text-xl"></i>
            </button>
            <h2 id="txt-worker-title" class="text-center text-xl font-bold mb-6 mt-2 text-gray-800">Create Work Profile</h2>

            <div class="grid grid-cols-3 gap-3 mb-6">
                <!-- Job Icons -->
                <div onclick="selectJob('Painter')" class="job-card cursor-pointer flex flex-col items-center p-3 rounded-xl border border-transparent bg-white/40 hover:bg-white hover:shadow-md transition-all">
                    <i class="fa-solid fa-paint-roller text-2xl text-orange-500 mb-1"></i>
                    <span class="text-xs font-medium">Painter</span>
                </div>
                <div onclick="selectJob('Electrician')" class="job-card cursor-pointer flex flex-col items-center p-3 rounded-xl border border-transparent bg-white/40 hover:bg-white hover:shadow-md transition-all">
                    <i class="fa-solid fa-bolt text-2xl text-yellow-500 mb-1"></i>
                    <span class="text-xs font-medium">Electrician</span>
                </div>
                <div onclick="selectJob('Plumber')" class="job-card cursor-pointer flex flex-col items-center p-3 rounded-xl border border-transparent bg-white/40 hover:bg-white hover:shadow-md transition-all">
                    <i class="fa-solid fa-faucet text-2xl text-blue-500 mb-1"></i>
                    <span class="text-xs font-medium">Plumber</span>
                </div>
                <div onclick="selectJob('Cleaner')" class="job-card cursor-pointer flex flex-col items-center p-3 rounded-xl border border-transparent bg-white/40 hover:bg-white hover:shadow-md transition-all">
                    <i class="fa-solid fa-broom text-2xl text-purple-500 mb-1"></i>
                    <span class="text-xs font-medium">Cleaner</span>
                </div>
                <div onclick="selectJob('Driver')" class="job-card cursor-pointer flex flex-col items-center p-3 rounded-xl border border-transparent bg-white/40 hover:bg-white hover:shadow-md transition-all">
                    <i class="fa-solid fa-car text-2xl text-red-500 mb-1"></i>
                    <span class="text-xs font-medium">Driver</span>
                </div>
                <div onclick="selectJob('Mechanic')" class="job-card cursor-pointer flex flex-col items-center p-3 rounded-xl border border-transparent bg-white/40 hover:bg-white hover:shadow-md transition-all">
                    <i class="fa-solid fa-wrench text-2xl text-gray-600 mb-1"></i>
                    <span class="text-xs font-medium">Mechanic</span>
                </div>
            </div>

            <div class="flex flex-col gap-4">
                <input type="text" id="worker-location" placeholder="Area / City Name" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white/50">
                <input type="text" id="worker-address" placeholder="Landmark / Full Address" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-white/50 mt-2">

                <input type="text" id="worker-selected-job" readonly placeholder="Select a job above" class="w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-100 text-gray-500 cursor-not-allowed">
                
                <button onclick="saveWorkerProfile()" class="btn-primary w-full py-3 rounded-xl font-bold shadow-lg mt-2">
                    <span id="txt-save-profile">Activate Profile</span>
                </button>
            </div>
        </div>

        <!-- VIEW: Customer Search -->
        <div id="view-search" class="w-full flex flex-col gap-4 fade-in hidden h-full">
            <div class="glass-panel p-4 sticky top-0 z-10">
                <div class="flex items-center gap-3 mb-4">
                    <button onclick="showView('view-home')" class="text-gray-500">
                        <i class="fa-solid fa-arrow-left text-xl"></i>
                    </button>
                    <h2 id="txt-search-title" class="font-bold text-lg text-gray-800">Find Help Nearby</h2>
                </div>

                <div class="flex gap-2">
                    <select id="search-job" class="flex-grow px-4 py-3 rounded-xl border border-gray-200 bg-white/80 focus:outline-none">
                        <option value="Painter">Painter</option>
                        <option value="Electrician">Electrician</option>
                        <option value="Plumber">Plumber</option>
                        <option value="Cleaner">Maid/Cleaner</option>
                        <option value="Driver">Driver</option>
                        <option value="Mechanic">Mechanic</option>
                    </select>
                    <button onclick="searchWorkers()" class="bg-gray-800 text-white w-12 rounded-xl flex items-center justify-center shadow-lg active:scale-95">
                        <i class="fa-solid fa-search"></i>
                    </button>
                </div>
            </div>

            <div id="results-container" class="flex flex-col gap-3 pb-20">
                <!-- Results injected here -->
                <div class="text-center mt-10 text-gray-400">
                    <i class="fa-solid fa-map-location-dot text-4xl mb-2"></i>
                    <p>Select a job and click search</p>
                </div>
            </div>
        </div>

    </div>

    <!-- FOOTER: Contact -->
    <footer class="fixed bottom-0 w-full glass-panel border-t border-white/50 py-3 rounded-b-none rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-40">
        <div class="flex justify-evenly items-center max-w-md mx-auto">
            <a href="https://wa.me/919239529167" target="_blank" class="flex flex-col items-center gap-1 text-green-500 hover:scale-110 transition-transform">
                <i class="fa-brands fa-whatsapp text-2xl"></i>
                <span class="text-[10px] font-bold">WhatsApp</span>
            </a>
            <a href="mailto:getsahay.india@gmail.com" class="flex flex-col items-center gap-1 text-red-500 hover:scale-110 transition-transform">
                <i class="fa-solid fa-envelope text-2xl"></i>
                <span class="text-[10px] font-bold">Email</span>
            </a>
            <a href="https://mallikabdurrahman37-hash.github.io/Versa-/index.html" target="_blank" class="flex flex-col items-center gap-1 text-purple-600 hover:scale-110 transition-transform">
                <div class="bg-purple-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs border-2 border-purple-200 shadow-md">
                    Dev
                </div>
            </a>
            <a href="https://www.instagram.com/mallik.edittion?igsh=YXNwdm52OWxydnpz" target="_blank" class="flex flex-col items-center gap-1 text-pink-500 hover:scale-110 transition-transform">
                <i class="fa-brands fa-instagram text-2xl"></i>
                <span class="text-[10px] font-bold">Insta</span>
            </a>
            <a href="https://youtube.com/@ayatserenity-t4i?si=95L1cSpIJ32j_NzN" target="_blank" class="flex flex-col items-center gap-1 text-red-600 hover:scale-110 transition-transform">
                <i class="fa-brands fa-youtube text-2xl"></i>
                <span class="text-[10px] font-bold">YouTube</span>
            </a>
        </div>
    </footer>

    <!-- Firebase SDKs (Using Modular Web SDK via CDN) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs, orderBy, limit, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDCwCbwWE04uOvMtI-4mrrQutnM65Fgxa4",
            authDomain: "sahay-f4c45.firebaseapp.com",
            databaseURL: "https://sahay-f4c45-default-rtdb.firebaseio.com",
            projectId: "sahay-f4c45",
            storageBucket: "sahay-f4c45.firebasestorage.app",
            messagingSenderId: "215909233174",
            appId: "1:215909233174:web:97e49dfb8481fe952ebb37",
            measurementId: "G-SG38X1JRF9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- TRANSLATIONS ---
        const translations = {
            en: {
                loginTitle: "Login",
                registerTitle: "Register",
                loginBtn: "Login",
                registerBtn: "Register Now",
                toggleLogin: "Already have account? Login",
                toggleReg: "New user? Register here",
                needWork: "I Need Work",
                needWorkDesc: "Find jobs nearby",
                needHelp: "I Need Help",
                needHelpDesc: "Find workers nearby",
                welcome: "Welcome,",
                searchTitle: "Find Help Nearby",
                workerTitle: "Create Work Profile",
                saveProfile: "Activate Profile",
                placeholderPhone: "Mobile Number",
                placeholderPass: "Password",
                placeholderName: "Your Name"
            },
            bn: {
                loginTitle: "লগইন করুন",
                registerTitle: "রেজিস্টার করুন",
                loginBtn: "লগইন",
                registerBtn: "রেজিস্টার",
                toggleLogin: "অ্যাকাউন্ট আছে? লগইন",
                toggleReg: "নতুন ব্যবহারকারী? রেজিস্টার করুন",
                needWork: "কাজ চাই",
                needWorkDesc: "কাছাকাছি কাজ খুঁজুন",
                needHelp: "সাহায্য চাই",
                needHelpDesc: "মিস্ত্রি বা সাহায্যকারী খুঁজুন",
                welcome: "স্বাগতম,",
                searchTitle: "সাহায্য খুঁজুন",
                workerTitle: "কাজের প্রোফাইল তৈরি করুন",
                saveProfile: "প্রোফাইল চালু করুন",
                placeholderPhone: "মোবাইল নম্বর",
                placeholderPass: "পাসওয়ার্ড",
                placeholderName: "আপনার নাম"
            },
            hi: {
                loginTitle: "लॉगिन करें",
                registerTitle: "रजिस्टर करें",
                loginBtn: "लॉगिन",
                registerBtn: "रजिस्टर",
                toggleLogin: "खाता है? लॉगिन करें",
                toggleReg: "नया उपयोगकर्ता? रजिस्टर करें",
                needWork: "काम चाहिए",
                needWorkDesc: "आसपास काम खोजें",
                needHelp: "मदद चाहिए",
                needHelpDesc: "कारीगर या सहायक खोजें",
                welcome: "स्वागत है,",
                searchTitle: "मदद खोजें",
                workerTitle: "वर्क प्रोफाइल बनाएं",
                saveProfile: "प्रोफाइल सक्रिय करें",
                placeholderPhone: "मोबाइल नंबर",
                placeholderPass: "पासवर्ड",
                placeholderName: "आपका नाम"
            }
        };

        // --- STATE MANAGEMENT ---
        let currentLang = 'en';
        let isLoginMode = true;
        let currentUser = null;

        // --- GLOBAL FUNCTIONS EXPORT TO WINDOW ---
        window.setLanguage = (lang) => {
            currentLang = lang;
            updateUIText();
            showView('view-auth');
        };

        window.showView = (viewId) => {
            // Hide all views
            ['view-language', 'view-auth', 'view-home', 'view-worker-form', 'view-search'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            // Show selected
            document.getElementById(viewId).classList.remove('hidden');
        };

        window.toggleAuthMode = () => {
            isLoginMode = !isLoginMode;
            const ui = translations[currentLang];
            
            const title = document.getElementById('txt-login-title');
            const btn = document.getElementById('txt-login-btn');
            const toggle = document.getElementById('txt-toggle-auth');
            const nameField = document.getElementById('reg-name-field');

            if(isLoginMode) {
                title.innerText = ui.loginTitle;
                btn.innerText = ui.loginBtn;
                toggle.innerText = ui.toggleReg;
                nameField.classList.add('hidden');
            } else {
                title.innerText = ui.registerTitle;
                btn.innerText = ui.registerBtn;
                toggle.innerText = ui.toggleLogin;
                nameField.classList.remove('hidden');
            }
        };

        // --- AUTH LOGIC (Phone Number Trick) ---
        // Since Email/Pass is reliable in Firebase Free Tier without setup, 
        // we append '@sahay.app' to phone numbers to treat them as emails.
        window.handleAuth = async () => {
            const phone = document.getElementById('auth-phone').value;
            const pass = document.getElementById('auth-pass').value;
            const name = document.getElementById('auth-name').value;
            const loader = document.getElementById('auth-loader');
            const btnText = document.getElementById('txt-login-btn');

            if(!phone || !pass) {
                showToast("Please fill all fields", "red");
                return;
            }

            // Fake email generation
            const email = phone + "@sahay.app";

            // UI Loading
            btnText.classList.add('hidden');
            loader.classList.remove('hidden');

            try {
                if(isLoginMode) {
                    // LOGIN
                    await signInWithEmailAndPassword(auth, email, pass);
                    // Auth state listener handles redirection
                } else {
                    // REGISTER
                    if(!name) { throw new Error("Name required"); }
                    const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                    await updateProfile(userCredential.user, { displayName: name });
                    // Auth state listener handles redirection
                }
            } catch (error) {
                console.error(error);
                let msg = "Error occurred";
                if(error.code === 'auth/wrong-password') msg = "Wrong password";
                if(error.code === 'auth/user-not-found') msg = "User not found";
                if(error.code === 'auth/email-already-in-use') msg = "Number already registered";
                showToast(msg, "red");
                btnText.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        };

        window.logout = () => {
            signOut(auth);
            showView('view-auth');
            document.getElementById('auth-phone').value = '';
            document.getElementById('auth-pass').value = '';
        };

        // --- DATABASE LOGIC ---

        // Worker Flow
        window.goToWorkerForm = () => showView('view-worker-form');

        window.selectJob = (job) => {
            document.getElementById('worker-selected-job').value = job;
            // Visual feedback
            document.querySelectorAll('.job-card').forEach(el => el.classList.remove('ring-2', 'ring-purple-500', 'bg-white'));
            event.currentTarget.classList.add('ring-2', 'ring-purple-500', 'bg-white');
        };

        window.saveWorkerProfile = async () => {
            if(!currentUser) return;
            const job = document.getElementById('worker-selected-job').value;
            const location = document.getElementById('worker-location').value;
            const address = document.getElementById('worker-address').value; // New Line


            if(!job || !location) {
                showToast("Please select job and location", "red");
                return;
            }

            try {
                // Add to Firestore
                await addDoc(collection(db, "workers"), {
    name: currentUser.displayName || "Worker",
    phone: currentUser.email.split('@')[0],
    job: job,
    location: location,
    address: address, // <--- ADD THIS LINE
    createdAt: new Date()
});
                showToast("Profile Active! You will get calls.", "green");
                showView('view-home');
            } catch (e) {
                showToast("Error saving profile", "red");
                console.error(e);
            }
        };

        // Customer Flow
        window.goToCustomerSearch = () => {
            showView('view-search');
            // Clear previous results
            document.getElementById('results-container').innerHTML = `
                <div class="text-center mt-10 text-gray-400">
                    <i class="fa-solid fa-map-location-dot text-4xl mb-2"></i>
                    <p>Select a job above to find people</p>
                </div>
            `;
        };

        window.searchWorkers = async () => {
            const jobType = document.getElementById('search-job').value;
            const container = document.getElementById('results-container');
            
            container.innerHTML = '<div class="w-full flex justify-center mt-10"><div class="loader border-gray-400"></div></div>';

            try {
                const q = query(collection(db, "workers"), where("job", "==", jobType), limit(10));
                const querySnapshot = await getDocs(q);
                
                container.innerHTML = ""; // Clear loader

                if(querySnapshot.empty) {
                    container.innerHTML = `<div class="text-center text-gray-500 mt-5">No ${jobType} found yet.</div>`;
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const card = document.createElement('div');
                    card.className = "glass-panel p-4 flex justify-between items-center animate-pulse-once";
                    card.innerHTML = `
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">${data.name}</h3>
                            <div class="text-xs text-gray-500 flex flex-col gap-1">
    <span><i class="fa-solid fa-map-pin text-red-400"></i> ${data.location}</span>
    <span class="text-gray-400 text-[10px] pl-4">${data.address ? data.address : ''}</span>
</div>
                            <div class="text-xs text-purple-600 font-bold mt-1 bg-purple-100 px-2 py-0.5 rounded-full inline-block">
                                ${data.job}
                            </div>
                        </div>
                        // This replaces the old call button line
<a href="tel:${data.phone}" onclick="trackCall('${doc.id}')" class="bg-green-500 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform hover:bg-green-600">
    <i class="fa-solid fa-phone"></i>
</a>
                    `;
                    container.appendChild(card);
                });

            } catch (e) {
                console.error(e);
                container.innerHTML = "Error loading data. Check console.";
            }
        };

        // --- UTILS ---
        function updateUIText() {
            const ui = translations[currentLang];
            
            // Auth View
            document.getElementById('txt-login-title').innerText = isLoginMode ? ui.loginTitle : ui.registerTitle;
            document.getElementById('txt-login-btn').innerText = isLoginMode ? ui.loginBtn : ui.registerBtn;
            document.getElementById('txt-toggle-auth').innerText = isLoginMode ? ui.toggleReg : ui.toggleLogin;
            document.getElementById('auth-phone').placeholder = ui.placeholderPhone;
            document.getElementById('auth-pass').placeholder = ui.placeholderPass;
            document.getElementById('auth-name').placeholder = ui.placeholderName;

            // Home View
            document.getElementById('txt-need-work').innerText = ui.needWork;
            document.getElementById('txt-need-work-desc').innerText = ui.needWorkDesc;
            document.getElementById('txt-need-help').innerText = ui.needHelp;
            document.getElementById('txt-need-help-desc').innerText = ui.needHelpDesc;
            document.getElementById('txt-welcome').innerText = ui.welcome;

            // Worker View
            document.getElementById('txt-worker-title').innerText = ui.workerTitle;
            document.getElementById('txt-save-profile').innerText = ui.saveProfile;

            // Search View
            document.getElementById('txt-search-title').innerText = ui.searchTitle;
        }

        function showToast(msg, color) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // --- AUTH LISTENER ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('user-display-name').innerText = user.displayName || "User";
                // If language selected, go home, else stay on language
                if(currentLang) showView('view-home'); 
            } else {
                currentUser = null;
                // If language selected, show auth, else language
                // Note: On first load, logic waits for user input
            }
        });

    </script>
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js')
        .then(registration => {
          console.log('ServiceWorker registration successful');
        })
        .catch(err => {
          console.log('ServiceWorker registration failed: ', err);
        });
    });
  }
        // --- NEW: TRACKING LOGIC ---
window.trackCall = async (docId) => {
    try {
        // This tells Firebase: "Find this worker and add +1 to their calls"
        const workerRef = doc(db, "workers", docId);
        await updateDoc(workerRef, {
            calls: increment(1)
        });
        console.log("Call tracked!");
    } catch (error) {
        console.error("Tracking error:", error);
    }
};
        
    </script>
    
</body>
</html>
